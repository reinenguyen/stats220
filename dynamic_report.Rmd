---
title: My dynamic report
output: html_fragment
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, error=FALSE)
library(tidyverse)
```

```{css}
body {
  background-color: #D9D9D9;
  color: #284B63;
  padding: 50px;
}

p {
  color: #3C6E71;
  padding: 0px 20px;
}

a { 
  color: #82204A;
}

img {
  display: block;
  margin: auto;
}

h3 {
  font-style: italic;
}

h4 {
  font-style: italic;
}

h2 {
  text-decoration: underline;
}

pre {
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  margin: 20px;
  padding: 10px 20px;
}
```

## Analyzing Tigger's preference for toys by location

We first try to analyze if Tiggers prefer any one room in the house to hang out and release some of her energy.
```{r}
# Read csv form data
csv_file <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vQLTXg5MuldGJkcDpyDl_t46_0IDrsl6APnKaIyPFk51z5DJE50fRnS8Vj8k8ybGabg86fFPUk2fWes/pub?output=csv"

logged_data <- read_csv(csv_file)

latest_data <- logged_data %>%
  rename(location = 2,
         hallway_toy = 3,
         hallway_time = 4,
         livingr_toy = 5,
         livingr_time = 6,
         kitchen_toy = 7,
         kitchen_time = 8,
         bedroom_toy = 9,
         bedroom_time = 10,
         yard_toy = 11,
         yard_time = 12)

latest_data %>%
  ggplot() +
  geom_bar(aes(x = location)) +
  theme_bw() +
  labs(title = "A study into Tiggers' play preference",
       subtitle = "Per location",
       x = "Location",
       y = "Count")

```

It looks like she likes to play with the toys in the kitchen and living room most often, while the hallway and yard are less frequented by her.

But as we are focusing more on her preference for the toys in this report, instead of how many times she plays in each room we should instead analyze how much she enjoys playing with the toys there i.e. how many minutes she plays in total in each room.

Let's see if the total amount of minutes she plays in the kitchen and living room really is the highest.

```{r}
latest_data
```

Due to the questions being divided into multiple sections based on the location of Tiggers, there are many missing values when it comes to the minutes played in other rooms for that entry. Let's try to combine the type and time for each play session into one column each so the data looks more clean.


```{r}
# Manipulate tibble into one unified table (one column for location, one column
# for toy)
unified_data <- latest_data %>% 
  mutate(time = case_when(
    hallway_time > 0 & !is.na(hallway_time) ~ hallway_time,
    livingr_time > 0 & !is.na(livingr_time) ~ livingr_time,
    kitchen_time > 0 & !is.na(kitchen_time) ~ kitchen_time,
    bedroom_time > 0 & !is.na(bedroom_time) ~ bedroom_time,
    yard_time > 0 & !is.na(yard_time) ~ yard_time,
    .default = 0)) %>%
  mutate(toy = case_when(
    !is.na(hallway_toy) ~ hallway_toy,
    !is.na(livingr_toy) ~ livingr_toy,
    !is.na(kitchen_toy) ~ kitchen_toy,
    !is.na(bedroom_toy) ~ bedroom_toy,
    .default = yard_toy)) %>%
  select(location, time, toy)

unified_data
```


Now we can try to calculate the total amount of minutes she play in each room

```{r}
# Calculate the total time Tiggers spent in each location
sorted_room <- arrange(unified_data, location)
sorted_room

total_bedroom <- sorted_room %>%
  slice(c(1 : 3)) %>%
  select(time) %>%
  sum()

total_hallway <- sorted_room %>%
  slice(c(4 : 5)) %>%
  select(time) %>%
  sum()

total_kitchen <- sorted_room %>%
  slice(c(6 : 10)) %>%
  select(time) %>%
  sum()

total_livingr <- sorted_room %>%
  slice(c(11 : 15)) %>%
  select(time) %>%
  sum()

total_yard <- sorted_room %>%
  slice(c(16 : 17)) %>%
  select(time) %>%
  sum()

total_location <- c(total_bedroom, total_kitchen, total_livingr, total_yard, total_hallway)

# Find the location with most and least amount of minutes Tiggers spent in
min_location <- min(total_location) 
max_location <- max(total_location)

```

We found out that for each location, her respective play times are:

- bedroom: `r total_bedroom`

- hallway: `r total_hallway`

- living room: `r total_livingr`

- yard: `r total_yard`

- kitchen: `r total_kitchen`

and that the most/least amount of minutes she plays in a room is `r max_location` and `r min_location` minutes respectively.

So while it's true that she likes to play in the living room the most, it seems like the kitchen isn't as popular as we were first let to believe, in fact losing to the bedroom. 

Let's try plotting by the minute for more accuracy

```{r}
# Plot the number of minutes Tiggers play per location
unified_data %>%
  ggplot() +
  geom_bar(aes(x = location, y = time, fill = toy), 
           stat = "identity") +
  scale_fill_brewer(palette = "Paired") +
  theme_bw() +
  labs(title = "A study into Tiggers' play preference",
       subtitle = "Per location",
       x = "Location",
       y = "Number of minutes play",
       fill = "Type of toy")
```

It would seem like the living room is by and far the most appealing to Tiggers to hang out and play, followed by the bedroom and the kitchen. It looks like there's no clear pattern here: while the living room and kitchen is where our family often hangs around the most, my bedroom is exclusive to me, so human presence is not an indicator. One thing is for sure though: she really prefers the indoors!

While not having as many toy options compared to most other rooms, we can see that the living room is still far ahead in play time. But does it have to do with the type of toys available in the room?


## Analyzing Tigger's preference for toys by type
We plot the play time with the toys in mind: 

```{r,fig.height=4.2,fig.width=12}
# Plot the number of minutes Tiggers play per toy
unified_data %>%
  ggplot() +
  geom_bar(aes(x = toy, y = time, fill = location), 
           stat = "identity") +
  scale_fill_brewer(palette = "Paired") +
  theme_bw() +
  labs(title = "A study into Tiggers' play preference",
       subtitle = "Per toy",
       x = "Toy",
       y = "Number of minutes play",
       fill = "Location")
```

We can see that the roller circuit toy, cat tunnel and banana catnip toy is the clear winner here, and so our previous data is starting to make more sense. It's starting to lean more towards the fact that she just really likes those toys. Let's examine further: 

```{r}
# Calculate the total time Tiggers spent playing each toy type
sorted_toy <- arrange(unified_data, toy)
sorted_toy

total_kicker <- sorted_toy %>%
  slice(c(2 : 3)) %>%
  select(time) %>%
  sum()

total_stationary <- sorted_toy %>%
  slice(c(6, 13, 14)) %>%
  select(time) %>%
  sum()

total_tunnel <- sorted_toy %>%
  slice(c(7 : 8)) %>%
  select(time) %>%
  sum()

total_batting <- sorted_toy %>%
  slice(c(1, 4 : 5, 9 : 12, 17)) %>%
  select(time) %>%
  sum()

total_scratch <- sorted_toy %>%
  slice(c(15, 16)) %>%
  select(time) %>%
  sum()

total_type <- c(total_kicker, total_stationary, total_tunnel, total_batting, total_scratch)
min_type <- min(total_type) 
max_type <- max(total_type)
```

We found out that for each toy type, her respective play times are:

- kicker toys (banana catnip toy): `r total_kicker`

- stationary interactive toys (roller circuit toy, cat dancer): `r total_stationary`

- mobile toys (an old shoelace, bell mouse, paper frog, ping pong ball, sprite bottle cap): `r total_batting`

- cat tunnel: `r total_tunnel`

- scratch post: `r total_scratch`


and that the most/least amount of minutes she plays with a toy is `r max_type` and `r min_type` minutes respectively.

While mobile toys are the most popular here, it's important to note that there are multiple toys included in that category, by individual they don't attract as many attention,  while the cat tunnel and kicker toy by themselves are fairly popular to Tiggers

## Conclusion

It would look like location has little to do with the toys Tiggers like to play with, as the time she plays in the living room and bedroom is heaving influenced by her attraction to the cat tunnel/roller circuit toy and banana catnip toy, respectively. There's no set type of toy she will preferably go for either. While you can look at the plot and say mobile toys are used the most the category included a whopping amount of 5 toys in total. The roller circuit toy is very popular, however the other toy in the category - the cat dancer, only has average playtime.

So in conclusion, Tiggers has some particular toys she really likes to play with regardless of location or type and it was silly of me to try and find a pattern. So whether toys I bought her in the future will please her is still up in the air, though I supposed I needn't buy any more mobile toys.